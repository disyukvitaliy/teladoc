### Intro

This project is backend engineer challenge for Teladoc company.

[Requirements](requirements.md)

### Development

1. Set SSH key on Github using instructions here: https://docs.github.com/en/authentication/connecting-to-github-with-ssh


2. Clone the project

```sh
git clone git@github.com:disyukvitaliy/teladoc.git
cd teladoc
```

3. Make sure you have docker and docker compose installed or install them https://docs.docker.com/compose/

```sh
docker compose -v
```

4. Build the project

```sh
docker compose build
docker compose run --rm back rails db:create db:migrate db:seed
```

5. Start the project

```sh
docker compose up
```

### Request examples

To list all the appointments:  
http://localhost:3000/api/appointments

To list all the appointments of a patient:  
http://localhost:3000/api/patient_appointments  
http://localhost:3000/api/patients/1/appointments

To see a specialist's schedule:  
http://localhost:3000/api/specialist/1/schedules

To book an appointment:
```sh
curl -H 'Content-Type: application/json' -X POST -d '{"appointment": { "id": 1 }}' http://localhost:3000/api/patient_appointments
```

To cancel an appointment:
```sh
curl -X DELETE http://localhost:3000/api/patient_appointments/1
```

To moderate an appointment:
```sh
curl -H 'Content-Type: application/json' -X PATCH -d '{"appointment": { "patient_id": 1 }}' http://localhost:3000/api/appointments
```

To delete an appointment:
```sh
curl -X DELETE http://localhost:3000/api/appointments/1
```

To create a schedule:
```sh
curl -H 'Content-Type: application/json' -X POST -d '{"schedule": { "start_offset": 540, "week_day": "sat", "appointment_duration": 30, "appointments_count": 6 }}' http://localhost:3000/api/specialists/1/schedules
```

To moderate a schedule:
```sh
curl -H 'Content-Type: application/json' -X PATCH -d '{"schedule": { "start_offset": 540 }}' http://localhost:3000/api/schedules/1
```

To delete a schedule:
```sh
curl -X DELETE http://localhost:3000/api/schedules/1
```

Execute something in the context of rails (`rails c`, `rails routes`)

```sh
docker compose run --rm back bash
```

### TODO

* Add serializers, devise, kaminari, etc...
* Add validations
* Change defaults and get rid of autogenerated code
* Better namings

### Architecture

We have model Schedule which represents schedule of a particular specialist for a particular day of week.
We can edit schedule of any specialist we have. Schedule model is organized the way which is convenient for dealing with using ruby code.
I decided not to store values like "08:00" which are good for humans but hard to manipulate for machines.
If we need to make it human readable we can do it on the FE part of the app or create a special presentation or serialization classes.

The core idea of managing appointments is creating them upfront. This way we can easily retrieve, update or delete them.
After editing schedule of a specialist, new appointments will be created using the new schedule.

The architecture is very simple and doesn't take into account cases like: different appointment duration during a day, lunch breaks, etc...

What about cons? We create appointments even if they are not used by anybody (however we can clear our DB from old unused records).
In case we want to support people who want to make appointments in the far future, we have to create huge amount of records.

A different approach could be creating appointments on demand considering schedule of a specialist and already created appointments.
It would be much difficult to implement because to get available slots we have to calculate the information on the fly every time.
There is higher chance of collisions and time intersections. It is much harder to acquire locks and maintain consistency.
We have to maintain history of schedule changes
